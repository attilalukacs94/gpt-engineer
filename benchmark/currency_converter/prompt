const axios = require('axios');
const NodeCache = require('node-cache');
const myCache = new NodeCache({ stdTTL: 3600, checkperiod: 120 });

async function getExchangeRate(fromCurrency, toCurrency) {
  const cacheKey = `${fromCurrency}_${toCurrency}`;
  const cachedRate = myCache.get(cacheKey);

  if (cachedRate) {
    return cachedRate;
  }

  const response = await axios.get(`https://api.exchangerate-api.com/v4/latest/${fromCurrency}`);
  const rate = response.data.rates[toCurrency];

  myCache.set(cacheKey, rate);

  return rate;
}

async function convertCurrency(fromCurrency, toCurrency, amount) {
  const exchangeRate = await getExchangeRate(fromCurrency, toCurrency);
  const convertedAmount = amount * exchangeRate;

  return convertedAmount;
}

module.exports = {
  convertCurrency
};